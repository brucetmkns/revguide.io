<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cards - RevGuide</title>
  <link rel="stylesheet" href="/admin/shared.css">
  <link rel="stylesheet" href="/admin/pages/wiki.css">
  <link rel="stylesheet" href="/admin/pages/cards.css">
  <link rel="stylesheet" href="/admin/pages/rules.css">
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <span class="logo-icon"><span class="icon icon-target-white"></span></span>
        <h1>RevGuide</h1>
      </div>
      <nav class="sidebar-nav">
        <a href="/home" class="nav-item" data-section="home">
          <span class="nav-icon"><span class="icon icon-home-white"></span></span>
          Home
        </a>
        <div class="nav-group" data-section="partner" id="partnerNavGroup" style="display: none;">
          <button class="nav-group-toggle" id="partnerNavToggle">
            <span class="nav-icon"><span class="icon icon-users-white"></span></span>
            <span class="nav-label">Partner</span>
            <svg class="nav-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </button>
          <div class="nav-group-menu">
            <a href="/partner-home" class="nav-item" data-section="partner-home">Home</a>
            <a href="/managed-accounts" class="nav-item" data-section="managed-accounts">Managed Accounts</a>
          </div>
        </div>
        <a href="/cards" class="nav-item active" data-section="cards">
          <span class="nav-icon"><span class="icon icon-layers-white"></span></span>
          Cards
        </a>
        <a href="/libraries" class="nav-item" data-section="libraries">
          <span class="nav-icon"><span class="icon icon-download-white"></span></span>
          Libraries
        </a>
        <a href="/settings" class="nav-item" data-section="settings">
          <span class="nav-icon"><span class="icon icon-settings-white"></span></span>
          Settings
        </a>
      </nav>
      <div class="sidebar-footer">
        <a href="mailto:support@revguide.io" class="sidebar-feedback-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg>
          <span>Send Feedback</span>
        </a>
        <div class="user-info">
          <div class="user-avatar" id="sidebarUserAvatar">...</div>
          <div class="user-details">
            <span class="user-name" id="sidebarUserName">Loading...</span>
            <span class="user-org" id="sidebarUserOrg"></span>
          </div>
          <button class="btn-icon logout-btn" title="Sign out" onclick="AdminShared.signOut()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
              <polyline points="16 17 21 12 16 7"/>
              <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
          </button>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <section class="content-section active" id="cardsSection">
        <!-- Page Header -->
        <div class="section-header">
          <div>
            <h2>Cards</h2>
            <p class="section-description">Manage all your contextual content - definitions, alerts, battlecards, and assets</p>
          </div>
          <div class="section-header-actions">
            <button class="btn btn-primary" id="addCardBtn">
              <span class="icon icon-plus"></span> Add Card
            </button>
          </div>
        </div>

        <!-- Two-Pane Layout -->
        <div class="wiki-layout">
          <!-- Left Navigation Pane -->
          <aside class="wiki-nav-pane">
            <!-- Search & Filters -->
            <div class="wiki-nav-toolbar">
              <div class="search-input-wrapper">
                <input type="text" class="search-input wiki-nav-search" id="cardsSearch" placeholder="Search cards...">
                <button type="button" class="search-clear-btn" id="cardsSearchClear" title="Clear search">
                  <span class="icon icon-x icon--sm"></span>
                </button>
              </div>
              <div class="wiki-nav-filters">
                <select class="filter-select" id="cardsObjectFilter">
                  <option value="all">All Objects</option>
                  <option value="contacts">Contacts</option>
                  <option value="companies">Companies</option>
                  <option value="deals">Deals</option>
                  <option value="tickets">Tickets</option>
                  <option value="custom">Custom</option>
                </select>
                <select class="filter-select" id="cardsTypeFilter">
                  <option value="all">All Types</option>
                  <option value="definition">Definitions</option>
                  <option value="alert">Alerts</option>
                  <option value="battlecard">Battlecards</option>
                  <option value="asset">Assets</option>
                </select>
              </div>
              <div class="wiki-nav-actions">
                <button class="btn btn-icon btn-sm" id="refreshCardsBtn" title="Refresh">
                  <span class="icon icon-refresh"></span>
                </button>
                <div class="wiki-nav-actions-right">
                  <button class="btn btn-icon btn-sm" id="cardsExpandAllBtn" data-tooltip="Expand all groups">
                    <span class="icon icon-chevrons-down"></span>
                  </button>
                  <button class="btn btn-icon btn-sm" id="cardsCollapseAllBtn" data-tooltip="Collapse all groups" data-tooltip-position="right">
                    <span class="icon icon-chevrons-up"></span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Navigation Tree -->
            <div class="wiki-nav-tree-container">
              <ul class="wiki-tree" id="cardsNavTree">
                <!-- Populated by JS -->
              </ul>

              <!-- Empty State for Nav -->
              <div class="wiki-nav-empty" id="cardsNavEmpty" style="display: none;">
                <span class="icon icon-layers icon--xl"></span>
                <p>No cards found</p>
              </div>
            </div>

            <!-- Stats -->
            <div class="wiki-nav-stats" id="cardsStats">
              <span class="wiki-stat"><strong id="cardsTotalCount">0</strong> total</span>
              <span class="wiki-stat"><strong id="cardsEnabledCount">0</strong> enabled</span>
              <span class="wiki-stat"><strong id="cardsDefinitionCount">0</strong> definitions</span>
            </div>
          </aside>

          <!-- Right Detail Pane -->
          <section class="wiki-detail-pane">
            <!-- Card View -->
            <div class="wiki-card" id="cardDetailCard">
              <!-- Card Header -->
              <header class="wiki-card-header">
                <div class="wiki-card-header-main">
                  <div class="wiki-card-title-row">
                    <h2 id="cardDetailTitle">Select a Card</h2>
                    <button class="status-toggle" id="cardStatusToggle" style="display: none;">
                      <span class="status-toggle-dot"></span>
                      <span class="status-toggle-label">Enabled</span>
                    </button>
                  </div>
                  <div class="wiki-card-meta" id="cardDetailMeta">
                    <!-- Populated by JS -->
                  </div>
                </div>
                <div class="wiki-card-actions" id="cardDetailActions" style="display: none;">
                  <button class="btn btn-primary btn-sm" id="saveCardBtnTop" title="Save">
                    <span class="icon icon-save icon--sm"></span> Save
                  </button>
                  <button class="btn btn-secondary btn-sm" id="duplicateCardBtn" title="Duplicate">
                    <span class="icon icon-copy icon--sm"></span> Duplicate
                  </button>
                  <button class="btn btn-danger btn-sm" id="deleteCardBtn" title="Delete">
                    <span class="icon icon-trash icon--sm"></span> Delete
                  </button>
                </div>
              </header>

              <!-- Tabs -->
              <nav class="wiki-card-tabs" role="tablist" id="cardDetailTabs">
                <button role="tab" aria-selected="true" data-tab="content" class="wiki-tab active">Content</button>
                <button role="tab" aria-selected="false" data-tab="rules" class="wiki-tab">Rules</button>
                <button role="tab" aria-selected="false" data-tab="assets" class="wiki-tab">Assets</button>
                <button role="tab" aria-selected="false" data-tab="usage" class="wiki-tab">Usage</button>
              </nav>

              <!-- Tab Panels -->
              <div class="wiki-card-body">
                <!-- Content Tab -->
                <section id="tab-content" role="tabpanel" class="wiki-tab-panel">
                  <div class="wiki-card-empty-state" id="cardDetailEmpty">
                    <span class="icon icon-layers icon--2xl"></span>
                    <h3>Select a card from the left</h3>
                    <p>Choose a card to view or edit its details</p>
                  </div>

                  <div class="wiki-card-content" id="cardDetailContent" style="display: none;">
                    <div class="wiki-content-form">
                      <!-- Card Type Indicator -->
                      <div class="card-type-indicator" id="cardTypeIndicator">
                        <span class="type-icon"><span class="icon icon-book"></span></span>
                        <span class="type-name">Definition</span>
                      </div>

                      <!-- Name -->
                      <div class="form-group">
                        <label>Name <span class="required">*</span></label>
                        <input type="text" id="cardName" placeholder="Internal name for this card">
                      </div>

                      <!-- Definition-specific fields -->
                      <div class="card-type-fields" id="definitionFields">
                        <div class="form-row">
                          <div class="form-group flex-1">
                            <label>Trigger Text</label>
                            <input type="text" id="cardTriggerText" placeholder="Text to match in HubSpot">
                            <span class="form-hint">The term that will show the tooltip icon</span>
                          </div>
                          <div class="form-group flex-1">
                            <label>Category</label>
                            <select id="cardCategory">
                              <option value="general">General</option>
                              <option value="sales">Sales</option>
                              <option value="marketing">Marketing</option>
                              <option value="product">Product</option>
                              <option value="process">Process</option>
                              <option value="field">HubSpot Field</option>
                            </select>
                          </div>
                        </div>
                        <div class="form-group">
                          <label>Aliases</label>
                          <input type="text" id="cardAliases" placeholder="Comma-separated alternative terms">
                          <span class="form-hint">Additional terms that trigger this definition</span>
                        </div>
                      </div>

                      <!-- Alert-specific fields -->
                      <div class="card-type-fields" id="alertFields" style="display: none;">
                        <div class="form-row">
                          <div class="form-group flex-1">
                            <label>Title</label>
                            <input type="text" id="cardTitle" placeholder="Banner title (optional)">
                          </div>
                          <div class="form-group flex-1">
                            <label>Alert Type</label>
                            <select id="cardBannerType">
                              <option value="info">Info (Blue)</option>
                              <option value="success">Success (Green)</option>
                              <option value="warning">Warning (Orange)</option>
                              <option value="error">Error (Red)</option>
                              <option value="embed">Embed (Media)</option>
                            </select>
                          </div>
                        </div>
                        <div class="form-group" id="cardEmbedUrlGroup" style="display: none;">
                          <label>Embed URL <span class="required">*</span></label>
                          <input type="url" id="cardEmbedUrl" placeholder="https://docs.google.com/presentation/d/... or video URL">
                          <span class="form-hint">Supports Google Slides, YouTube, Loom, Vimeo</span>
                        </div>
                      </div>

                      <!-- Battlecard-specific fields -->
                      <div class="card-type-fields" id="battlecardFields" style="display: none;">
                        <div class="form-row">
                          <div class="form-group flex-1">
                            <label>Subtitle</label>
                            <input type="text" id="cardSubtitle" placeholder="Brief description">
                          </div>
                          <div class="form-group flex-1">
                            <label>Battlecard Type</label>
                            <select id="cardBattlecardType">
                              <option value="competitor">Competitor</option>
                              <option value="objection">Objection Handler</option>
                              <option value="tip">Tip / Best Practice</option>
                              <option value="process">Process Guide</option>
                            </select>
                          </div>
                        </div>
                        <div class="form-group">
                          <label>Documentation Link</label>
                          <input type="url" id="cardLink" placeholder="Link to full documentation">
                        </div>
                      </div>

                      <!-- Asset-specific fields -->
                      <div class="card-type-fields" id="assetFields" style="display: none;">
                        <div class="form-group">
                          <label>Asset URL <span class="required">*</span></label>
                          <input type="url" id="cardAssetUrl" placeholder="Link to the asset">
                        </div>
                        <div class="form-group">
                          <label>Asset Type</label>
                          <select id="cardAssetType">
                            <option value="document">Document</option>
                            <option value="video">Video</option>
                            <option value="presentation">Presentation</option>
                            <option value="case-study">Case Study</option>
                            <option value="link">External Link</option>
                          </select>
                        </div>
                      </div>

                      <!-- Content/Definition -->
                      <div class="form-group">
                        <label id="cardContentLabel">Definition</label>
                        <div id="cardContentEditor"></div>
                      </div>

                      <!-- Sections (for battlecards) -->
                      <div class="form-group" id="cardSectionsGroup" style="display: none;">
                        <label>Sections</label>
                        <div class="sections-builder" id="cardSections">
                          <!-- Sections added by JS -->
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm" id="addSectionBtn">
                          <span class="icon icon-plus icon--sm"></span> Add Section
                        </button>
                      </div>

                      <!-- Related Link (for definitions) -->
                      <div class="form-group" id="cardLinkGroup">
                        <label>Related Link</label>
                        <input type="url" id="cardDefinitionLink" placeholder="https://docs.google.com/...">
                        <span class="form-hint">Optional link to documentation or more details</span>
                      </div>
                    </div>

                    <!-- Preview -->
                    <div class="wiki-content-preview">
                      <h4>Preview</h4>
                      <div class="wiki-preview" id="cardPreview">
                        <div class="wiki-preview-card">
                          <div class="wiki-preview-header">
                            <span class="wiki-preview-term">Term</span>
                            <span class="wiki-preview-category">Category</span>
                          </div>
                          <div class="wiki-preview-content">
                            <p>Your content will appear here</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- Rules Tab -->
                <section id="tab-rules" role="tabpanel" class="wiki-tab-panel" hidden>
                  <div class="wiki-card-empty-state" id="cardRulesEmpty">
                    <span class="icon icon-settings icon--2xl"></span>
                    <h3>Select a card to configure rules</h3>
                    <p>Choose a card from the left to set up where and how it appears</p>
                  </div>

                  <div class="wiki-rules-content" id="cardRulesContent" style="display: none;">
                    <!-- Where to Show -->
                    <div class="wiki-rules-section">
                      <h4>Where to Show</h4>

                      <div class="form-row">
                        <div class="form-group flex-1">
                          <label>HubSpot Object</label>
                          <select id="cardObjectType">
                            <option value="">None (All objects)</option>
                            <option value="contacts">Contacts</option>
                            <option value="companies">Companies</option>
                            <option value="deals">Deals</option>
                            <option value="tickets">Tickets</option>
                          </select>
                        </div>
                        <div class="form-group flex-1">
                          <label>Property Group</label>
                          <select id="cardPropertyGroup">
                            <option value="">Select a property group...</option>
                          </select>
                          <span class="form-hint">Optional group for organization</span>
                        </div>
                      </div>

                      <div class="form-group">
                        <label>Display Modes</label>
                        <div class="display-modes-options">
                          <label class="checkbox-label">
                            <input type="checkbox" id="displayModeTooltip" value="tooltip">
                            <span>Tooltip</span>
                          </label>
                          <label class="checkbox-label">
                            <input type="checkbox" id="displayModeBanner" value="banner">
                            <span>Banner</span>
                          </label>
                          <label class="checkbox-label">
                            <input type="checkbox" id="displayModeSidepanel" value="sidepanel">
                            <span>Side Panel</span>
                          </label>
                        </div>
                      </div>

                      <div class="form-group">
                        <label class="checkbox-label">
                          <input type="checkbox" id="cardDisplayOnAll">
                          <span>Display on all records</span>
                        </label>
                        <span class="form-hint">When enabled, this card shows on all records of the selected object type</span>
                      </div>
                    </div>

                    <!-- Conditions -->
                    <div class="wiki-rules-section" id="cardConditionsWrapper">
                      <h4>Conditions</h4>
                      <span class="form-hint">Define when this card should appear based on record properties</span>
                      <div class="logic-toggle" id="cardLogicToggle">
                        <span class="logic-label">Match:</span>
                        <button type="button" class="logic-btn active" data-value="AND">All conditions (AND)</button>
                        <button type="button" class="logic-btn" data-value="OR">Any condition (OR)</button>
                      </div>
                      <div class="conditions-builder" id="cardConditions">
                        <!-- Conditions added by JS -->
                      </div>
                      <button class="btn btn-secondary btn-sm" id="addCardConditionBtn">
                        <span class="icon icon-plus icon--sm"></span> Add Condition
                      </button>
                    </div>

                    <!-- Matching Behavior (for definitions) -->
                    <div class="wiki-rules-section" id="definitionRulesSection">
                      <h4>Matching Behavior</h4>

                      <div class="form-row">
                        <div class="form-group flex-1">
                          <label>Match Type</label>
                          <select id="cardMatchType">
                            <option value="exact">Exact match</option>
                            <option value="case-insensitive">Case-insensitive</option>
                            <option value="starts-with">Starts with</option>
                          </select>
                        </div>
                        <div class="form-group flex-1">
                          <label>Frequency</label>
                          <select id="cardFrequency">
                            <option value="first">First instance only</option>
                            <option value="all">Every occurrence</option>
                          </select>
                        </div>
                      </div>

                      <div class="form-row">
                        <div class="form-group flex-1">
                          <label class="checkbox-label">
                            <input type="checkbox" id="cardIncludeAliases" checked>
                            <span>Also match aliases</span>
                          </label>
                        </div>
                        <div class="form-group flex-1">
                          <label>Priority</label>
                          <input type="number" id="cardPriority" min="0" max="100" value="50" placeholder="0-100">
                          <span class="form-hint">Higher priority matches first</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- Assets Tab -->
                <section id="tab-assets" role="tabpanel" class="wiki-tab-panel" hidden>
                  <div class="wiki-card-empty-state" id="cardAssetsEmpty">
                    <span class="icon icon-link icon--2xl"></span>
                    <h3>Select a card to add assets</h3>
                    <p>Choose a card from the left to attach related resources</p>
                  </div>

                  <div class="wiki-rules-content" id="cardAssetsContent" style="display: none;">
                    <div class="wiki-rules-section">
                      <h4>Related Assets</h4>
                      <span class="form-hint">Add links to documents, videos, or other resources to share with prospects</span>
                      <div class="assets-list" id="cardAssetsList">
                        <!-- Assets added by JS -->
                      </div>
                      <button type="button" class="btn btn-secondary btn-sm" id="addAssetBtn">
                        <span class="icon icon-plus icon--sm"></span> Add Asset
                      </button>
                    </div>

                    <div class="wiki-rules-section">
                      <h4>Suggested Next Steps</h4>
                      <span class="form-hint">Recommend actions for the rep to take</span>
                      <div class="next-steps-list" id="cardNextStepsList">
                        <!-- Next steps added by JS -->
                      </div>
                      <button type="button" class="btn btn-secondary btn-sm" id="addNextStepBtn">
                        <span class="icon icon-plus icon--sm"></span> Add Next Step
                      </button>
                    </div>
                  </div>
                </section>

                <!-- Usage Tab -->
                <section id="tab-usage" role="tabpanel" class="wiki-tab-panel" hidden>
                  <div class="wiki-card-empty-state" id="cardUsageEmpty">
                    <span class="icon icon-chart icon--2xl"></span>
                    <h3>Select a card to view usage</h3>
                    <p>Choose a card from the left to see its metadata and statistics</p>
                  </div>

                  <div class="wiki-usage-content" id="cardUsageContent" style="display: none;">
                    <div class="wiki-usage-section">
                      <h4>Card Information</h4>
                      <div class="wiki-usage-stats">
                        <div class="wiki-usage-stat">
                          <span class="wiki-usage-stat-label">Created</span>
                          <span class="wiki-usage-stat-value" id="cardCreatedAt">-</span>
                        </div>
                        <div class="wiki-usage-stat">
                          <span class="wiki-usage-stat-label">Last Updated</span>
                          <span class="wiki-usage-stat-value" id="cardUpdatedAt">-</span>
                        </div>
                      </div>
                    </div>

                    <div class="wiki-usage-section wiki-usage-placeholder">
                      <span class="icon icon-trending-up icon--xl"></span>
                      <h4>Usage Analytics Coming Soon</h4>
                      <p>In a future version, this tab will show usage statistics and recent activity.</p>
                    </div>
                  </div>
                </section>

                <!-- Save Actions -->
                <div class="wiki-card-footer" id="cardDetailFooter" style="display: none;">
                  <button class="btn btn-secondary" id="cancelCardBtn">Cancel</button>
                  <button class="btn btn-primary" id="saveCardBtn">Save Card</button>
                </div>
              </div>
            </div>
          </section>
        </div>
      </section>
    </main>
  </div>

  <!-- Add Card Modal (for type selection when creating new) -->
  <div class="modal" id="addCardModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add New Card</h2>
        <button class="modal-close" id="closeAddCardModal">
          <span class="icon icon-x"></span>
        </button>
      </div>
      <div class="modal-body">
        <p class="modal-description">Select the type of card you want to create:</p>
        <div class="card-type-options">
          <button type="button" class="card-type-option" data-type="definition">
            <span class="icon icon-book"></span>
            <span class="type-label">Definition</span>
            <span class="type-desc">Tooltip with term definition</span>
          </button>
          <button type="button" class="card-type-option" data-type="alert">
            <span class="icon icon-clipboard-list"></span>
            <span class="type-label">Alert</span>
            <span class="type-desc">Banner notification on records</span>
          </button>
          <button type="button" class="card-type-option" data-type="battlecard">
            <span class="icon icon-layers"></span>
            <span class="type-label">Battlecard</span>
            <span class="type-desc">Reference guide in side panel</span>
          </button>
          <button type="button" class="card-type-option" data-type="asset">
            <span class="icon icon-link"></span>
            <span class="type-label">Asset</span>
            <span class="type-desc">Shareable content link</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="/admin/supabase.js"></script>
  <script src="/admin/hubspot.js"></script>
  <script src="/lib/wiki-cache.js"></script>
  <script src="/admin/shared.js"></script>
  <script type="module" src="/admin/lib/tiptap-editor.js"></script>
  <script src="/admin/pages/cards.js"></script>

  <!-- Help Scout Beacon -->
  <script type="text/javascript">!function(e,t,n){function a(){var e=t.getElementsByTagName("script")[0],n=t.createElement("script");n.type="text/javascript",n.async=!0,n.src="https://beacon-v2.helpscout.net",e.parentNode.insertBefore(n,e)}if(e.Beacon=n=function(t,n,a){e.Beacon.readyQueue.push({method:t,options:n,data:a})},n.readyQueue=[],"complete"===t.readyState)return a();e.attachEvent?e.attachEvent("onload",a):e.addEventListener("load",a,!1)}(window,document,window.Beacon||function(){});</script>
  <script type="text/javascript">window.Beacon('init', '3bd8f7ea-8853-4f72-bf02-f22113313a1d')</script>
</body>
</html>
